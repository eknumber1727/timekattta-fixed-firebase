<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Timepass Katta – Create</title>
  <link rel="stylesheet" href="./css/ui.css">
  <meta name="theme-color" content="#FF7A00">
</head>
<body>
  <header class="tk-header">
    <div class="left">
      <img src="./assets/logo-tk.png" alt="TK" class="logo" onerror="this.style.display='none'">
      <div class="brand">
        <h1>Timepass Katta</h1>
        <p>Create | Share | Repeat</p>
      </div>
    </div>
    <a class="admin-link" href="./tpk-dev-zone/">Admin</a>
  </header>

  <section class="hero">
    <div class="gradient"></div>
    <div class="cta">
      <button id="pickBtn" class="btn primary">Pick a Photo</button>
      <input id="fileInput" type="file" accept="image/*" hidden>
      <p class="hint">No login. Instant edit. Totally free.</p>
    </div>
  </section>

  <main class="editor">
    <div class="canvas-wrap">
      <canvas id="stage" width="750" height="750"></canvas>
      <div class="tips">Pinch to zoom • Drag to move • Double tap to fit</div>
    </div>

    <div class="toolbar">
      <div class="tabs">
        <button class="tab active" data-tab="frames">Frames</button>
        <button class="tab" data-tab="text">Text</button>
        <button class="tab" data-tab="share">Share</button>
      </div>

      <div class="panel show" id="panel-frames">
        <div id="frames" class="chips"></div>
      </div>

      <div class="panel" id="panel-text">
        <div class="row">
          <input id="addText" placeholder="Add a caption…" />
          <button id="addTextBtn" class="btn">Add</button>
        </div>
      </div>

      <div class="panel" id="panel-share">
        <div class="row actions">
          <button id="downloadBtn" class="btn">Download</button>
          <button id="shareBtn" class="btn outline">Share</button>
        </div>
      </div>
    </div>
  </main>

  <nav class="bottom-nav">
    <button id="resetBtn" title="Reset">Reset</button>
    <button id="fitBtn" title="Fit">Fit</button>
    <button id="flipBtn" title="Flip">Flip</button>
  </nav>

  <script type="module">
    import { uploadFile } from './js/modules/storage.js';
    import './js/modules/editor.js';

    window.tkSaveToCloud = async (blob) => {
      try {
        const file = new File([blob], `tpk-${Date.now()}.png`, { type: 'image/png' });
        const res = await uploadFile(file, 'exports');
        console.log('Saved to Firebase:', res.url);
      } catch (e) {
        console.warn('Upload to Firebase skipped:', e.message);
      }
    };
  </script>
</body>
</html>
